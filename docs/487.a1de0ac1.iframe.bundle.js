"use strict";(self.webpackChunkh5p_editor_topic_map=self.webpackChunkh5p_editor_topic_map||[]).push([[487],{"./src/components/Draggable/Draggable.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>Draggable});var react=__webpack_require__("./node_modules/react/index.js"),H5P_util=__webpack_require__("./src/H5P/H5P.util.ts"),clamp=function clamp(min,value,max){return Math.min(max,Math.max(min,value))},calculateClosestValidSizeComponent=function calculateClosestValidSizeComponent(attemptedSize,gapSize,cellSize,gridSize){var stepSize=cellSize+gapSize,stepNumber=attemptedSize/stepSize,smallerWidth=Math.floor(stepNumber)*stepSize-gapSize,largerWidth=Math.ceil(stepNumber)*stepSize-gapSize;return clamp(cellSize,attemptedSize-smallerWidth<largerWidth-attemptedSize?smallerWidth:largerWidth,gridSize)},calculateClosestValidPositionComponent=function calculateClosestValidPositionComponent(position,gapSize,cellSize,gridSizeComponent,elementSizeComponent){var stepSize=cellSize+gapSize,closestInNegativeDirection=Math.floor(position/stepSize)*stepSize,closestInPositiveDirection=Math.ceil(position/stepSize)*stepSize,negativeIsClosest=Math.abs(position-closestInNegativeDirection)<Math.abs(position-closestInPositiveDirection);return clamp(0,negativeIsClosest?closestInNegativeDirection:closestInPositiveDirection,gridSizeComponent-elementSizeComponent)},getPointerPositionFromEvent=function getPointerPositionFromEvent(event){var pos;if(function isMouseEvent(event){return null!=event.clientX}(event)){pos={x:event.clientX,y:event.clientY}}else{var _event$touches$=event.touches[0];pos={x:_event$touches$.clientX,y:_event$touches$.clientY}}return pos},grid_utils=__webpack_require__("./src/utils/grid.utils.ts"),ContextMenu=__webpack_require__("./src/components/ContextMenu/ContextMenu.tsx"),capitalize=function capitalize(str){return 0===str.length?"":str[0].toUpperCase()+str.slice(1)};const ScaleHandle_module={scaleHandle:"ScaleHandle-module__scaleHandle--Vf16J",scaleHandleLeft:"ScaleHandle-module__scaleHandleLeft--T1gxZ",scaleHandleTopLeft:"ScaleHandle-module__scaleHandleTopLeft--DRZkY",scaleHandleBottomLeft:"ScaleHandle-module__scaleHandleBottomLeft--_gCqD",scaleHandleRight:"ScaleHandle-module__scaleHandleRight--oTqX4",scaleHandleTopRight:"ScaleHandle-module__scaleHandleTopRight--FGB2K",scaleHandleBottomRight:"ScaleHandle-module__scaleHandleBottomRight--UbrjE",scaleHandleTop:"ScaleHandle-module__scaleHandleTop--Hn64e",scaleHandleBottom:"ScaleHandle-module__scaleHandleBottom--dGTgF"};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ScaleHandle=function ScaleHandle(_ref){var labelText=_ref.labelText,position=_ref.position,onScaleStop=_ref.onScaleStop,onScaleStart=_ref.onScaleStart,_React$useState2=_slicedToArray(react.useState(!1),2),isDragging=_React$useState2[0],setIsDragging=_React$useState2[1],elementRef=react.useRef(null),className=ScaleHandle_module["scaleHandle".concat(position.split("-").map(capitalize).join(""))],startDrag=react.useCallback((function(event){setIsDragging(!0),onScaleStart(),event.stopPropagation()}),[onScaleStart]),stopDrag=react.useCallback((function(){isDragging&&(setIsDragging(!1),onScaleStop())}),[isDragging,onScaleStop]);return react.useEffect((function(){return window.addEventListener("mouseup",stopDrag),window.addEventListener("touchend",stopDrag),function(){window.removeEventListener("mouseup",stopDrag),window.removeEventListener("touchend",stopDrag)}}),[stopDrag]),(0,jsx_runtime.jsx)("div",{ref:elementRef,role:"button",tabIndex:0,className:"".concat(ScaleHandle_module.scaleHandle," ").concat(className," scaleHandle"),"aria-label":labelText,onMouseDown:startDrag,onTouchStart:startDrag})};ScaleHandle.displayName="ScaleHandle";try{ScaleHandle.displayName="ScaleHandle",ScaleHandle.__docgenInfo={description:"",displayName:"ScaleHandle",props:{labelText:{defaultValue:null,description:"",name:"labelText",required:!0,type:{name:"string"}},position:{defaultValue:null,description:"",name:"position",required:!0,type:{name:"enum",value:[{value:'"left"'},{value:'"top"'},{value:'"top-left"'},{value:'"bottom"'},{value:'"right"'},{value:'"top-right"'},{value:'"bottom-right"'},{value:'"bottom-left"'}]}},onScaleStop:{defaultValue:null,description:"",name:"onScaleStop",required:!0,type:{name:"() => void"}},onScaleStart:{defaultValue:null,description:"",name:"onScaleStart",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ScaleHandle/ScaleHandle.tsx#ScaleHandle"]={docgenInfo:ScaleHandle.__docgenInfo,name:"ScaleHandle",path:"src/components/ScaleHandle/ScaleHandle.tsx#ScaleHandle"})}catch(__react_docgen_typescript_loader_error){}var ScaleHandles=function ScaleHandles(_ref){var setIsResizing=_ref.setIsResizing,startResize=_ref.startResize,stopResize=_ref.stopResize,verticalScaleHandleLabelText=_ref.verticalScaleHandleLabelText,horizontalScaleHandleLabelText=_ref.horizontalScaleHandleLabelText;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ScaleHandle,{position:"top",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("horizontal-top")},onScaleStop:function onScaleStop(){return stopResize()},labelText:verticalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"top-right",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("top")},onScaleStop:function onScaleStop(){return stopResize()},labelText:verticalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"right",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("vertical")},onScaleStop:function onScaleStop(){return stopResize()},labelText:horizontalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"bottom-right",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("none")},onScaleStop:function onScaleStop(){return stopResize()},labelText:horizontalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"bottom",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("horizontal")},onScaleStop:function onScaleStop(){return stopResize()},labelText:verticalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"bottom-left",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("left")},onScaleStop:function onScaleStop(){return stopResize()},labelText:verticalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"left",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("vertical-left")},onScaleStop:function onScaleStop(){return stopResize()},labelText:horizontalScaleHandleLabelText}),(0,jsx_runtime.jsx)(ScaleHandle,{position:"top-left",onScaleStart:function onScaleStart(){setIsResizing(!0),startResize("top-left")},onScaleStop:function onScaleStop(){return stopResize()},labelText:horizontalScaleHandleLabelText})]})};try{ScaleHandles.displayName="ScaleHandles",ScaleHandles.__docgenInfo={description:"",displayName:"ScaleHandles",props:{setIsResizing:{defaultValue:null,description:"",name:"setIsResizing",required:!0,type:{name:"(isResizing: boolean) => void"}},startResize:{defaultValue:null,description:"",name:"startResize",required:!0,type:{name:"(handlePosition: ResizeDirection) => void"}},stopResize:{defaultValue:null,description:"",name:"stopResize",required:!0,type:{name:"() => void"}},verticalScaleHandleLabelText:{defaultValue:null,description:"",name:"verticalScaleHandleLabelText",required:!0,type:{name:"string"}},horizontalScaleHandleLabelText:{defaultValue:null,description:"",name:"horizontalScaleHandleLabelText",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ScaleHandles/ScaleHandles.tsx#ScaleHandles"]={docgenInfo:ScaleHandles.__docgenInfo,name:"ScaleHandles",path:"src/components/ScaleHandles/ScaleHandles.tsx#ScaleHandles"})}catch(__react_docgen_typescript_loader_error){}var Toolbar=__webpack_require__("./src/components/Toolbar/Toolbar.tsx");const Draggable_module={draggable:"Draggable-module__draggable--QMt20",preview:"Draggable-module__preview--oJIPL",inner:"Draggable-module__inner--K3DDv"};function Draggable_slicedToArray(arr,i){return function Draggable_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function Draggable_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}(arr,i)||function Draggable_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return Draggable_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Draggable_arrayLikeToArray(o,minLen)}(arr,i)||function Draggable_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Draggable_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var labelTextKeys_selected="draggable_selected",labelTextKeys_notSelected="draggable_not-selected",Draggable=function Draggable(_ref){var id=_ref.id,initialXPosition=_ref.initialXPosition,initialYPosition=_ref.initialYPosition,updatePosition=_ref.updatePosition,initialWidth=_ref.initialWidth,initialHeight=_ref.initialHeight,gapSize=_ref.gapSize,cellSize=_ref.cellSize,gridSize=_ref.gridSize,occupiedCells=_ref.occupiedCells,isPreview=_ref.isPreview,openDeleteDialogue=_ref.openDeleteDialogue,setSelectedItem=_ref.setSelectedItem,selectedItem=_ref.selectedItem,startResize=_ref.startResize,children=_ref.children,mouseOutsideGrid=_ref.mouseOutsideGrid,editItem=_ref.editItem,showScaleHandles=_ref.showScaleHandles,onPointerDown=_ref.onPointerDown,activeTool=_ref.activeTool,_useState2=Draggable_slicedToArray((0,react.useState)(!1),2),isDragging=_useState2[0],setIsDragging=_useState2[1],_useState4=Draggable_slicedToArray((0,react.useState)(selectedItem===id),2),isSelected=_useState4[0],setIsSelected=_useState4[1],_useState6=Draggable_slicedToArray((0,react.useState)((0,H5P_util.t)(labelTextKeys_notSelected)),2),labelText=_useState6[0],setLabelText=_useState6[1],_useState8=Draggable_slicedToArray((0,react.useState)(null),2),pointerStartPosition=_useState8[0],setPointerStartPosition=_useState8[1],_useState10=Draggable_slicedToArray((0,react.useState)({width:calculateClosestValidSizeComponent(initialWidth,gapSize,cellSize,gridSize.width),height:calculateClosestValidSizeComponent(initialHeight,gapSize,cellSize,gridSize.height)}),2),_useState10$=_useState10[0],width=_useState10$.width,height=_useState10$.height,setSize=_useState10[1],_useState12=Draggable_slicedToArray((0,react.useState)({x:calculateClosestValidPositionComponent(initialXPosition,gapSize,cellSize,gridSize.width,width),y:calculateClosestValidPositionComponent(initialYPosition,gapSize,cellSize,gridSize.height,height)}),2),position=_useState12[0],setPosition=_useState12[1],_useState14=Draggable_slicedToArray((0,react.useState)(position),2),previousPosition=_useState14[0],setPreviousPosition=_useState14[1],_useState16=Draggable_slicedToArray((0,react.useState)(!1),2),isResizing=_useState16[0],setIsResizing=_useState16[1];(0,react.useEffect)((function(){return setSize({width:calculateClosestValidSizeComponent(initialWidth,gapSize,cellSize,gridSize.width),height:calculateClosestValidSizeComponent(initialHeight,gapSize,cellSize,gridSize.height)})}),[gapSize,cellSize,gridSize.height,gridSize.width,initialHeight,initialWidth]),(0,react.useEffect)((function(){setPosition({x:calculateClosestValidPositionComponent(initialXPosition,gapSize,cellSize,gridSize.width,width),y:calculateClosestValidPositionComponent(initialYPosition,gapSize,cellSize,gridSize.height,height)})}),[gapSize,cellSize,gridSize.height,gridSize.width,height,initialXPosition,initialYPosition,width]);var elementRef=(0,react.useRef)(null),startDrag=(0,react.useCallback)((function(event){onPointerDown(getPointerPositionFromEvent(event));var aToolIsActive=null!==activeTool,createBoxToolIsActive=activeTool===Toolbar.S.CreateBox;if(!aToolIsActive||createBoxToolIsActive){setIsDragging(!0),setIsSelected(!0),setSelectedItem(id);var _getPointerPositionFr=getPointerPositionFromEvent(event),x=_getPointerPositionFr.x,y=_getPointerPositionFr.y;setPointerStartPosition({x:x-position.x,y:y-position.y})}}),[onPointerDown,activeTool,setSelectedItem,id,position.x,position.y]),getNewPosition=(0,react.useCallback)((function(x,y){return{x,y}}),[]),getClosestValidXPosition=(0,react.useCallback)((function(pointerX){return calculateClosestValidPositionComponent(pointerX,gapSize,cellSize,gridSize.width,width)}),[gapSize,cellSize,gridSize.width,width]),getClosestValidYPosition=(0,react.useCallback)((function(pointerY){return calculateClosestValidPositionComponent(pointerY,gapSize,cellSize,gridSize.height,height)}),[gapSize,cellSize,gridSize.height,height]),checkIfPositionIsFree=(0,react.useCallback)((function(newPosition){return(0,grid_utils.vN)(newPosition,id,{width,height},gridSize,gapSize,cellSize,occupiedCells)}),[gapSize,cellSize,gridSize,height,id,occupiedCells,width]),stopDrag=(0,react.useCallback)((function(){var x=position.x,y=position.y,closestValidXPosition=getClosestValidXPosition(x),closestValidYPosition=getClosestValidYPosition(y);if(null!=closestValidXPosition&&null!=closestValidYPosition){var _newPosition=getNewPosition(closestValidXPosition,closestValidYPosition);checkIfPositionIsFree(_newPosition)?(setPosition(_newPosition),updatePosition(_newPosition),setPreviousPosition(_newPosition)):setPosition(previousPosition)}setPointerStartPosition(null),setIsDragging(!1)}),[position,getClosestValidXPosition,getClosestValidYPosition,getNewPosition,checkIfPositionIsFree,updatePosition,previousPosition]),drag=(0,react.useCallback)((function(event){if(isDragging&&pointerStartPosition)if(mouseOutsideGrid)stopDrag();else{var _getPointerPositionFr2=getPointerPositionFromEvent(event),x=_getPointerPositionFr2.x,y=_getPointerPositionFr2.y,newPosition=getNewPosition(x-pointerStartPosition.x,y-pointerStartPosition.y);setPosition(newPosition)}}),[isDragging,pointerStartPosition,mouseOutsideGrid,getNewPosition,stopDrag]),preventDefault=(0,react.useCallback)((function(event){event.preventDefault()}),[]);(0,react.useEffect)((function(){setLabelText(isSelected?(0,H5P_util.t)(labelTextKeys_selected):(0,H5P_util.t)(labelTextKeys_notSelected))}),[isSelected]);(0,react.useEffect)((function(){return window.addEventListener("mousemove",drag),window.addEventListener("touchmove",drag),function(){window.removeEventListener("mousemove",drag),window.removeEventListener("touchmove",drag)}}),[drag]);var stopResize=(0,react.useCallback)((function(){stopDrag(),setIsResizing(!1)}),[stopDrag]),contextMenuActions=(0,react.useMemo)((function(){return[{icon:ContextMenu.B.Edit,label:(0,H5P_util.t)("context-menu_edit"),onClick:function onClick(){return editItem(id)}},{icon:ContextMenu.B.Delete,label:(0,H5P_util.t)("context-menu_delete"),onClick:function onClick(){return openDeleteDialogue(id)}}]}),[editItem,id,openDeleteDialogue]);return(0,jsx_runtime.jsxs)("div",{id,ref:elementRef,role:"button",tabIndex:0,draggable:"true",onDragStart:preventDefault,"aria-grabbed":isDragging,className:"".concat(Draggable_module.draggable," ").concat(isPreview&&Draggable_module.preview," draggable ").concat(activeTool===Toolbar.S.CreateArrow&&Draggable_module.arrow_mode),onMouseDown:startDrag,onTouchStart:startDrag,style:{transform:"translateX(".concat(position.x,"px) translateY(").concat(position.y,"px)"),width:width+2,height:height+2,zIndex:isDragging||selectedItem===id?2:void 0,pointerEvents:isPreview||isResizing?"none":void 0,transition:isPreview||isResizing?"none":void 0},"aria-label":labelText,onMouseUp:stopDrag,onTouchEnd:stopDrag,onDoubleClick:function onDoubleClick(){return editItem(id)},"data-draggable":!0,children:[(0,jsx_runtime.jsx)("div",{className:Draggable_module.inner,tabIndex:-1,children}),activeTool!==Toolbar.S.CreateArrow&&showScaleHandles&&(0,jsx_runtime.jsx)(ScaleHandles,{setIsResizing,startResize,stopResize,verticalScaleHandleLabelText:"",horizontalScaleHandleLabelText:""}),(0,jsx_runtime.jsx)(ContextMenu.x,{actions:contextMenuActions,show:selectedItem===id,turnLeft:(0,grid_utils.uk)(position.x,gridSize.width)})]})};Draggable.displayName="Draggable";try{Draggable.displayName="Draggable",Draggable.__docgenInfo={description:"",displayName:"Draggable",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},initialXPosition:{defaultValue:null,description:"",name:"initialXPosition",required:!0,type:{name:"number"}},initialYPosition:{defaultValue:null,description:"",name:"initialYPosition",required:!0,type:{name:"number"}},updatePosition:{defaultValue:null,description:"",name:"updatePosition",required:!0,type:{name:"(newPosition: Position) => void"}},initialWidth:{defaultValue:null,description:"",name:"initialWidth",required:!0,type:{name:"number"}},initialHeight:{defaultValue:null,description:"",name:"initialHeight",required:!0,type:{name:"number"}},gapSize:{defaultValue:null,description:"",name:"gapSize",required:!0,type:{name:"number"}},cellSize:{defaultValue:null,description:"",name:"cellSize",required:!0,type:{name:"number"}},gridSize:{defaultValue:null,description:"",name:"gridSize",required:!0,type:{name:"Size"}},occupiedCells:{defaultValue:null,description:"",name:"occupiedCells",required:!0,type:{name:"OccupiedCell[]"}},isPreview:{defaultValue:null,description:"",name:"isPreview",required:!0,type:{name:"boolean"}},openDeleteDialogue:{defaultValue:null,description:"",name:"openDeleteDialogue",required:!0,type:{name:"(id: string) => void"}},setSelectedItem:{defaultValue:null,description:"",name:"setSelectedItem",required:!0,type:{name:"(newItem: string | null) => void"}},selectedItem:{defaultValue:null,description:"",name:"selectedItem",required:!0,type:{name:"string | null"}},startResize:{defaultValue:null,description:"",name:"startResize",required:!0,type:{name:"(directionLock: ResizeDirection) => void"}},mouseOutsideGrid:{defaultValue:null,description:"",name:"mouseOutsideGrid",required:!0,type:{name:"boolean"}},editItem:{defaultValue:null,description:"",name:"editItem",required:!0,type:{name:"(id: string) => void"}},showScaleHandles:{defaultValue:null,description:"",name:"showScaleHandles",required:!0,type:{name:"boolean"}},onPointerDown:{defaultValue:null,description:"",name:"onPointerDown",required:!0,type:{name:"(pointerPosition: Position) => void"}},activeTool:{defaultValue:null,description:"",name:"activeTool",required:!0,type:{name:"ToolbarButtonType | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Draggable/Draggable.tsx#Draggable"]={docgenInfo:Draggable.__docgenInfo,name:"Draggable",path:"src/components/Draggable/Draggable.tsx#Draggable"})}catch(__react_docgen_typescript_loader_error){}}}]);